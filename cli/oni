#! /usr/bin/env node

var path = require('path')
var spawn = require('child_process').spawn
const os = require("os"),
      fs = require("fs");

let processOptions = {}
let log = require('path').join(__dirname, 'out.log')
let out = fs.openSync(log, 'a')
let err = fs.openSync(log, 'a')
processOptions.shell = true
processOptions.detached = true
processOptions.stdio = [ 'ignore', "ignore", "ignore"]

// Check for Windows, assume macOS/Windows otherwise
const isWindows = os.platform() === "win32";
const electronBinFile = isWindows ? "electron.cmd" : "electron"
var electronPath = path.join(__dirname, "..", "node_modules", ".bin", electronBinFile)
var args = process.argv.slice(2);
args.unshift(path.resolve(path.join(__dirname, "..", "main.js")))

// In Windows, for the `electron.cmd`, the spawn has to be done with cmd.exe -
// otherwise we'll end up with a floating node console
let spawnProcess = isWindows ? "cmd.exe" : electronPath
let spawnArgs = isWindows ? ["/c", electronPath].concat(args) : args

console.log(spawnProcess)
console.log(spawnArgs)

let child = new spawn(spawnProcess, spawnArgs, processOptions)

process.exit(0)
